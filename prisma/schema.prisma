// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Poem {
    id        String   @id @default(cuid())
    title     String
    version   String // "junior" or "senior"
    tags      String[]
    author    String?
    dynasty   String?
    mode      String // "poem" or "paragraph"
    content   String
    starredBy Star[]

    @@map("poems")
}

model User {
    id       Int       @id
    star     Star[]
    checkIns CheckIn[]

    @@map("users")
}

model CheckIn {
    id      String   @id @default(cuid())
    user    User     @relation(fields: [userId], references: [id])
    userId  Int
    date    DateTime @default(now())
    quote   Quote    @relation(fields: [quoteId], references: [id])
    quoteId String

    @@unique([userId, date])
    @@index([userId])
    @@index([date])
    @@map("check_ins")
}

model Star {
    id     Int    @id @default(autoincrement())
    user   User   @relation(fields: [userId], references: [id])
    userId Int
    poem   Poem   @relation(fields: [poemId], references: [id])
    poemId String

    @@unique([userId, poemId])
    @@index([userId])
    @@index([poemId])
    @@map("stars")
}

model Author {
    id      String   @id @default(cuid())
    name    String   @unique
    dynasty String?
    epithet String?
    quote   String?
    avatar  String?
    intro   String?
    tags    String[]

    @@map("authors")
}

model Article {
    id       String   @id @default(cuid())
    title    String   @unique
    author   String?
    dynasty  String?
    views    Int      @default(0)
    abstract String?
    content  String?
    img      String?
    tags     String[]

    @@map("articles")
}

model Quote {
    id       String    @id @default(cuid())
    title    String
    quote    String
    author   String
    dynasty  String?
    checkIns CheckIn[]

    @@map("quotes")
}

model Event {
    id         String  @id @default(cuid())
    year       Int
    month      Int
    day        Int
    type       String // "event", "birth", or "death"
    figure     String?
    importance Int     @default(0)
    data       String

    @@map("events")
}
